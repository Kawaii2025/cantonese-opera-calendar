# 快速数据导入指南

## 操作步骤

### 1️⃣ 填入Neon连接字符串

编辑 `.env` 文件，将你的Neon数据库连接字符串替换进去：

```bash
# 从 https://console.neon.tech 获取
DATABASE_URL=postgresql://username:password@ep-xxx-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require
PORT=3001
```

### 2️⃣ 运行初始化脚本

```bash
npm run init
```

这个脚本会：
- ✅ 删除旧表（如果存在）
- ✅ 创建新的 events 表
- ✅ 创建性能索引
- ✅ 插入所有 320+ 条演出数据
- ✅ 显示统计信息

### 3️⃣ 启动API服务

```bash
npm run dev        # 开发模式（推荐）
# 或
npm run start      # 生产模式
```

## 预期输出

```
🚀 开始数据库初始化和数据导入...

🗑️  清理旧表（如果存在）...
✅ 旧表已清理

🏗️  创建 events 表...
✅ events 表已创建

📑 创建性能索引...
✅ 索引已创建

📝 插入演出数据...
✅ 成功插入 320 条记录

📊 数据统计信息:

   📅 总演出场次: 320
   🗓️  演出日期数: 101
   🎭 剧团数量: 7
   🏙️  城市数量: 8
   📍 时间跨度: 2025-01-01 至 2025-03-31

🎭 各剧团演出统计:

   红豆团: 87 场
   深圳团: 52 场
   佛山团: 45 场
   广州团: 38 场
   省一团: 35 场
   省二团: 32 场
   省院: 1 场

🏙️  各城市演出统计:

   茂名: 102 场
   广州: 68 场
   佛山: 45 场
   湛江: 32 场
   东莞: 31 场
   深圳: 18 场
   北海: 14 场
   香港: 10 场

✨ 数据库初始化和数据导入完成！

🚀 可以开始使用 API 了：
   npm run dev         # 启动开发服务器
   npm run start       # 启动生产服务器
```

## 故障排除

### 连接失败
检查 `.env` 文件中的 DATABASE_URL 是否正确，确保包含完整的用户名、密码和主机信息。

### 权限错误
确保 Neon 账户有创建表的权限。

### 已存在的表
脚本会自动删除旧表，不需要手动处理。

## 可用脚本

| 命令 | 说明 |
|------|------|
| `npm run init` | 一键初始化：建表 + 导入数据 |
| `npm run dev` | 启动开发服务器（热重载） |
| `npm run start` | 启动生产服务器 |
| `npm run test-connection` | 测试数据库连接 |
